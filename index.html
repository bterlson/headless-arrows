<!doctype html>
<head><meta charset="utf-8">
<link href="ecmarkup.css" rel="stylesheet">
<script src="ecmarkup.js"></script>
<title>Headless Arrow Functions</title></head><body><div id="menu-toggle">☰</div><div id="menu"><div id="menu-toc"><ol class="toc"><li><span class="item-toggle">◢</span><a href="#sec-intro" title="Introduction"><span class="secnum"></span> Introduction</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-interaction-with-async-functions" title="Interaction with Async Functions"><span class="secnum"></span> Interaction with Async Functions</a></li></ol></li><li><span class="item-toggle">◢</span><a href="#sec-arrow-function-definitions" title="Arrow Function Definitions"><span class="secnum">1</span> Arrow Function Definitions</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">1.1</span> RS: Evaluation</a></li><li><span class="item-toggle-none"></span><a href="#sec-ss-early-errors" title="Static Semantics: Early Errors"><span class="secnum">1.2</span> SS: Early Errors</a></li><li><span class="item-toggle-none"></span><a href="#sec-ss-HasName" title="Static Semantics: HasName"><span class="secnum">1.3</span> SS: HasName</a></li><li><span class="item-toggle-none"></span><a href="#sec-ss-Contains" title="Static Semantics: Contains"><span class="secnum">1.4</span> SS: Contains</a></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-Table-27" title="Table 27"><span class="secnum">2</span> Table 27</a></li><li><span class="item-toggle-none"></span><a href="#sec-FunctionDeclarationInstantiation" title="FunctionDeclarationInstantiation(_func_, _argumentsList_)"><span class="secnum">3</span> FunctionDeclarationInstantiation(<var>func</var>, <var>argumentsList</var>)</a></li><li><span class="item-toggle-none"></span><a href="#sec-copyright-and-software-license" title="Copyright &amp; Software License"><span class="secnum">A</span> Copyright &amp; Software License</a></li></ol></div></div><h1 class="version">Stage -1 Draft / October 18, 2015</h1><h1 class="title">Headless Arrow Functions</h1>
<emu-intro id="sec-intro">
  <h1><span class="secnum"></span>Introduction<span class="utils"><span class="anchor"><a href="#sec-intro">#</a></span></span></h1>
  <p>ES2015 arrow functions require an empty parameter list when you don't want any parameters, eg: <code>p.then(() =&gt; resolve())</code>. This proposal makes it syntactically valid to omit the empty parameter list, eg: <code>p.then(=&gt; resolve())</code>. The [no <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-LineTerminator">LineTerminator</a></emu-nt> here] restriction after the <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ArrowParameters">ArrowParameters</a></emu-nt> of  <emu-nt><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt> ensures there is no syntactic difficulty. Minor modifications are required to the grammar and a few abstract operations.</p>

  <emu-intro id="sec-interaction-with-async-functions">
    <h1><span class="secnum"></span>Interaction with Async Functions<span class="utils"><span class="anchor"><a href="#sec-interaction-with-async-functions">#</a></span></span></h1>
    <p>In the current async functions proposal, there is a syntactic form for async arrow functions:</p>
    <pre><code>
      async () =&gt; 1;
    </code></pre>
    <p>This might lead developers to try to use the following headless async arrow:</p>
    <pre><code>
      async =&gt; new Promise();
    </code></pre>
    <p>Unfortunately, this is a perfectly valid arrow function with one parameter named  <code>async</code>. This may make this proposal untenable, or it might be a good reason to remove async arrows from the async functions proposal.</p>
  </emu-intro>
</emu-intro>
<emu-clause id="sec-arrow-function-definitions">
  <h1><span class="secnum">1</span>Arrow Function Definitions<span class="utils"><span class="anchor"><a href="#sec-arrow-function-definitions">#</a></span></span></h1>
  <p>The alernative  <emu-grammar collapsed=""><emu-production name="ArrowFunction" id="prod-ArrowFunction" class=" inline">
    <emu-nt><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="457e2a39"><emu-t>=&gt;</emu-t><emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ConciseBody">ConciseBody</a></emu-nt></emu-rhs>
</emu-production></emu-grammar> is added to <emu-nt><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt>:</p>
  <emu-grammar><emu-production name="ArrowFunction" params="In, Yield, Await">
    <emu-nt params="In, Yield, Await"><a href="#prod-ArrowFunction">ArrowFunction</a><emu-mods><emu-params>[In, Yield, Await]</emu-params></emu-mods></emu-nt><emu-geq>:</emu-geq><emu-rhs a="0be22025"><emu-nt params="?Yield, ?Await"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ArrowParameters">ArrowParameters</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt><emu-gann>[no <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann><emu-t>=&gt;</emu-t><emu-nt params="?In"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ConciseBody">ConciseBody</a><emu-mods><emu-params>[?In]</emu-params></emu-mods></emu-nt></emu-rhs>
    <emu-rhs a="5455bbca"><emu-t>=&gt;</emu-t><emu-nt params="?In"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ConciseBody">ConciseBody</a><emu-mods><emu-params>[?In]</emu-params></emu-mods></emu-nt></emu-rhs>
</emu-production></emu-grammar>
  <emu-clause id="sec-evaluation">
    <h1><span class="secnum">1.1</span>Runtime Semantics: Evaluation<span class="utils"><span class="anchor"><a href="#sec-evaluation">#</a></span></span></h1>
    <emu-grammar collapsed=""><emu-production name="ArrowFunction">
    <emu-nt><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="457e2a39"><emu-t>=&gt;</emu-t><emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ConciseBody">ConciseBody</a></emu-nt></emu-rhs>
</emu-production></emu-grammar>
    <emu-alg><ol><li>If the function code for this <emu-nt><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt> is <emu-xref href="#sec-strict-mode-code"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-strict-mode-code">strict mode code</a></emu-xref>, let <var>strict</var> be <emu-val>true</emu-val>. Otherwise let <var>strict</var> be <emu-val>false</emu-val>.</li><li>Let <var>scope</var> be the LexicalEnvironment of the running <emu-xref href="#sec-execution-contexts"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-execution-contexts">execution context</a></emu-xref>.</li><li>Let <var>closure</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-functioncreate">FunctionCreate</a>(<emu-const>Arrow</emu-const>, <emu-const>empty</emu-const>, <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ConciseBody">ConciseBody</a></emu-nt>, <var>scope</var>, <var>strict</var>).</li><li>Return <var>closure</var>.
    </li></ol></emu-alg>
  </emu-clause>
  <emu-clause id="sec-ss-early-errors">
    <h1><span class="secnum">1.2</span>Static Semantics: Early Errors<span class="utils"><span class="anchor"><a href="#sec-ss-early-errors">#</a></span></span></h1>
    <emu-grammar collapsed=""><emu-production name="ArrowFunction">
    <emu-nt><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="457e2a39"><emu-t>=&gt;</emu-t><emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ConciseBody">ConciseBody</a></emu-nt></emu-rhs>
</emu-production></emu-grammar>
    <emu-alg><ul><li>It is a Syntax Error if <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ConciseBody">ConciseBody</a></emu-nt> Contains <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-YieldExpression">YieldExpression</a></emu-nt> is <emu-val>true</emu-val>.
    </li></ul></emu-alg>
  </emu-clause>
  <emu-clause id="sec-ss-HasName">
    <h1><span class="secnum">1.3</span>Static Semantics: HasName<span class="utils"><span class="anchor"><a href="#sec-ss-HasName">#</a></span></span></h1>
    <emu-grammar collapsed=""><emu-production name="ArrowFunction">
    <emu-nt><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="457e2a39"><emu-t>=&gt;</emu-t><emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ConciseBody">ConciseBody</a></emu-nt></emu-rhs>
</emu-production></emu-grammar>
    <emu-alg><ol><li>Return <emu-val>false</emu-val>.
    </li></ol></emu-alg>
  </emu-clause>
  <emu-clause id="sec-ss-Contains">
    <h1><span class="secnum">1.4</span>Static Semantics: Contains<span class="utils"><span class="anchor"><a href="#sec-ss-Contains">#</a></span></span></h1>
    <p>With parameter <var>symbol</var>.</p>
    <emu-grammar collapsed=""><emu-production name="ArrowFunction">
    <emu-nt><a href="#prod-ArrowFunction">ArrowFunction</a></emu-nt><emu-geq>:</emu-geq><emu-rhs a="457e2a39"><emu-t>=&gt;</emu-t><emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ConciseBody">ConciseBody</a></emu-nt></emu-rhs>
</emu-production></emu-grammar>
    <emu-alg><ol><li>If <var>symbol</var> is not one of <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-NewTarget">NewTarget</a></emu-nt>, <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-SuperProperty">SuperProperty</a></emu-nt>, <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-SuperCall">SuperCall</a></emu-nt>, <code>super</code> or <code>this</code>, return <emu-val>false</emu-val>.</li><li>Return <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ConciseBody">ConciseBody</a></emu-nt> Contains <var>symbol</var>.
    </li></ol></emu-alg>
  </emu-clause>
</emu-clause>
<emu-clause id="sec-Table-27">
  <h1><span class="secnum">2</span>Table 27<span class="utils"><span class="anchor"><a href="#sec-Table-27">#</a></span></span></h1>
  <p><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#table-27">Table 27</a>'s row for [[FormalParameters]] is modified as follows:</p>
  <emu-table><figure><figcaption>Table 1: Modified Table 27</figcaption>
    
    <table>
      <tbody><tr><th>Internal Slot</th><th>Type</th><th>Description</th></tr>
      <tr><td>[[FormalParameters]]</td><td>Parse Node  <ins>|  <emu-const>empty</emu-const></ins></td><td><ins>If the value is a Parse Node, then it is</ins> the root parse node of the source text that defines the function's formal parameter list.</td></tr>
  </tbody></table>
</figure></emu-table></emu-clause>
<emu-clause id="sec-FunctionDeclarationInstantiation">
  <h1><span class="secnum">3</span>FunctionDeclarationInstantiation(<var>func</var>, <var>argumentsList</var>)<span class="utils"><span class="anchor"><a href="#sec-FunctionDeclarationInstantiation">#</a></span></span></h1>
  <emu-note><span class="note">Note</span>
  <p><emu-xref aoid="FunctionDeclarationInstantiation"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-functiondeclarationinstantiation">FunctionDeclarationInstantiation</a></emu-xref> is performed as follows using arguments <var>func</var> and <var>argumentsList</var>. <var>func</var> is the function object for which the <emu-xref href="#sec-execution-contexts"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-execution-contexts">execution context</a></emu-xref> is being established.</p>
  <emu-alg><ol><li>Let <var>calleeContext</var> be the running <emu-xref href="#sec-execution-contexts"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-execution-contexts">execution context</a></emu-xref>.</li><li>Let <var>env</var> be the LexicalEnvironment of <var>calleeContext</var>.</li><li>Let <var>envRec</var> be <var>env</var>'s <emu-xref href="#sec-lexical-environments"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-lexical-environments">EnvironmentRecord</a></emu-xref>.</li><li>Let <var>code</var> be the value of the [[ECMAScriptCode]] internal slot of <var>func</var>.</li><li>Let <var>strict</var> be the value of the [[Strict]] internal slot of <var>func</var>.</li><li>Let <var>formals</var> be the value of the [[FormalParameters]] internal slot of <var>func</var>.</li><li><ins>If <var>formals</var> is <emu-const>empty</emu-const>, then</ins><ol><li><ins>Let <var>hasDuplicates</var> be <emu-val>false</emu-val>.</ins></li><li><ins>Let <var>parameterNames</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-list-and-record-specification-type">List</a></emu-xref>.</ins></li><li><ins>Let <var>simpleParameterList</var> be <emu-val>true</emu-val>.</ins></li><li><ins>Let <var>hasParameterExpressions</var> be <emu-val>false</emu-val>.</ins></li></ol></li><li><ins>Else,</ins><ol><li>Let <var>parameterNames</var> be the BoundNames of <var>formals</var>.</li><li>If <var>parameterNames</var> has any duplicate entries, let <var>hasDuplicates</var> be <emu-val>true</emu-val>. Otherwise, let <var>hasDuplicates</var> be <emu-val>false</emu-val>.</li><li>Let <var>simpleParameterList</var> be IsSimpleParameterList of <var>formals</var>.</li><li>Let <var>hasParameterExpressions</var> be ContainsExpression of <var>formals</var>.</li></ol></li><li>Let <var>varNames</var> be the VarDeclaredNames of <var>code</var>.</li><li>Let <var>varDeclarations</var> be the VarScopedDeclarations of <var>code</var>.</li><li>Let <var>lexicalNames</var> be the LexicallyDeclaredNames of <var>code</var>.</li><li>Let <var>functionNames</var> be an empty <emu-xref href="#sec-list-and-record-specification-type"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>functionsToInitialize</var> be an empty <emu-xref href="#sec-list-and-record-specification-type"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>For each <var>d</var> in <var>varDeclarations</var>, in reverse list order do<ol><li>If <var>d</var> is neither a <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-VariableDeclaration">VariableDeclaration</a></emu-nt> or a <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-ForBinding">ForBinding</a></emu-nt>, then<ol><li>Assert: <var>d</var> is either a <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-FunctionDeclaration">FunctionDeclaration</a></emu-nt> or a <emu-nt><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#prod-GeneratorDeclaration">GeneratorDeclaration</a></emu-nt>.</li><li>Let <var>fn</var> be the sole element of the BoundNames of <var>d</var>.</li><li>If <var>fn</var> is not an element of <var>functionNames</var>, then<ol><li>Insert <var>fn</var> as the first element of <var>functionNames</var>.</li><li>NOTE If there are multiple |FunctionDeclaration|s or |GeneratorDeclaration|s for the same name, the last declaration is used.</li><li>Insert <var>d</var> as the first element of <var>functionsToInitialize</var>.</li></ol></li></ol></li></ol></li><li>Let <var>argumentsObjectNeeded</var> be <emu-val>true</emu-val>.</li><li>If the value of the [[ThisMode]] internal slot of <var>func</var> is <emu-const>lexical</emu-const>, then<ol><li>NOTE Arrow functions never have an arguments objects.</li><li>Let <var>argumentsObjectNeeded</var> be <emu-val>false</emu-val>.</li></ol></li><li>Else if <code>"arguments"</code> is an element of <var>parameterNames</var>, then<ol><li>Let <var>argumentsObjectNeeded</var> be <emu-val>false</emu-val>.</li></ol></li><li>Else if <var>hasParameterExpressions</var> is <emu-val>false</emu-val>, then<ol><li>If <code>"arguments"</code> is an element of <var>functionNames</var> or if <code>"arguments"</code> is an element of <var>lexicalNames</var>, then<ol><li>Let <var>argumentsObjectNeeded</var> be <emu-val>false</emu-val>.</li></ol></li></ol></li><li>For each String <var>paramName</var> in <var>parameterNames</var>, do<ol><li>Let <var>alreadyDeclared</var> be <var>envRec</var>.HasBinding(<var>paramName</var>).</li><li>NOTE Early errors ensure that duplicate parameter names can only occur in non-strict functions that do not have parameter default values or rest parameters.</li><li>If <var>alreadyDeclared</var> is <emu-val>false</emu-val>, then<ol><li>Let <var>status</var> be <var>envRec</var>.CreateMutableBinding(<var>paramName</var>).</li><li>If <var>hasDuplicates</var> is <emu-val>true</emu-val>, then<ol><li>Let <var>status</var> be <var>envRec</var>.InitializeBinding(<var>paramName</var>, <emu-val>undefined</emu-val>).</li></ol></li><li>Assert: <var>status</var> is never an <emu-xref href="#sec-completion-record-specification-type"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-completion-record-specification-type">abrupt completion</a></emu-xref> for either of the above operations.</li></ol></li></ol></li><li>If <var>argumentsObjectNeeded</var> is <emu-val>true</emu-val>, then<ol><li>If <var>strict</var> is <emu-val>true</emu-val> or if <var>simpleParameterList</var> is <emu-val>false</emu-val>, then<ol><li>Let <var>ao</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-createunmappedargumentsobject">CreateUnmappedArgumentsObject</a>(<var>argumentsList</var>).</li></ol></li><li>Else,<ol><li>NOTE mapped argument object is only provided for non-strict functions that don't have a rest parameter, any parameter default value initializers, or any destructured parameters .</li><li>Let <var>ao</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-createmappedargumentsobject">CreateMappedArgumentsObject</a>(<var>func</var>, <var>formals</var>, <var>argumentsList</var>, <var>env</var>).</li></ol></li><li><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-returnifabrupt">ReturnIfAbrupt</a>(<var>ao</var>).</li><li>If <var>strict</var> is <emu-val>true</emu-val>, then<ol><li>Let <var>status</var> be <var>envRec</var>.CreateImmutableBinding(<code>"arguments"</code>).</li></ol></li><li>Else,<ol><li>Let <var>status</var> be <var>envRec</var>.CreateMutableBinding(<code>"arguments"</code>).</li></ol></li><li>Assert: <var>status</var> is never an <emu-xref href="#sec-completion-record-specification-type"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-completion-record-specification-type">abrupt completion</a></emu-xref>.</li><li>Call <var>envRec</var>.InitializeBinding(<code>"arguments"</code>, <var>ao</var>).</li><li>Append <code>"arguments"</code> to <var>parameterNames</var>.</li></ol></li><li>Let <var>iteratorRecord</var> be Record {[[iterator]]: <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-createlistiterator">CreateListIterator</a>(<var>argumentsList</var>), [[done]]: <emu-val>false</emu-val>}.</li><li><ins>If <var>formals</var> is not <emu-const>empty</emu-const>, then</ins><ol><li>If <var>hasDuplicates</var> is <emu-val>true</emu-val>, then<ol><li>Let <var>formalStatus</var> be IteratorBindingInitialization for <var>formals</var> with <var>iteratorRecord</var> and <emu-val>undefined</emu-val> as arguments.</li></ol></li><li>Else,<ol><li>Let <var>formalStatus</var> be IteratorBindingInitialization for <var>formals</var> with <var>iteratorRecord</var> and <var>env</var> as arguments.</li></ol></li><li><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-returnifabrupt">ReturnIfAbrupt</a>(<var>formalStatus</var>).</li></ol></li><li>If <var>hasParameterExpressions</var> is <emu-val>false</emu-val>, then<ol><li>NOTE Only a single lexical environment is needed for the parameters and top-level vars.</li><li>Let <var>instantiatedVarNames</var> be a copy of the <emu-xref href="#sec-list-and-record-specification-type"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-list-and-record-specification-type">List</a></emu-xref> <var>parameterNames</var>.</li><li>For each <var>n</var> in <var>varNames</var>, do<ol><li>If <var>n</var> is not an element of <var>instantiatedVarNames</var>, then<ol><li>Append <var>n</var> to <var>instantiatedVarNames</var>.</li><li>Let <var>status</var> be <var>envRec</var>.CreateMutableBinding(<var>n</var>).</li><li>Assert: <var>status</var> is never an <emu-xref href="#sec-completion-record-specification-type"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-completion-record-specification-type">abrupt completion</a></emu-xref>.</li><li>Call <var>envRec</var>.InitializeBinding(<var>n</var>, <emu-val>undefined</emu-val>).</li></ol></li></ol></li><li>Let <var>varEnv</var> be <var>env</var>.</li><li>Let <var>varEnvRec</var> be <var>envRec</var>.</li></ol></li><li>Else,<ol><li>NOTE A separate <emu-xref href="#sec-environment-records"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-environment-records">Environment Record</a></emu-xref> is needed to ensure that closures created by expressions in the formal parameter list do not have visibility of declarations in the function body.</li><li>Let <var>varEnv</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-newdeclarativeenvironment">NewDeclarativeEnvironment</a>(<var>env</var>).</li><li>Let <var>varEnvRec</var> be <var>varEnv</var>'s <emu-xref href="#sec-lexical-environments"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-lexical-environments">EnvironmentRecord</a></emu-xref>.</li><li>Set the VariableEnvironment of <var>calleeContext</var> to <var>varEnv</var>.</li><li>Let <var>instantiatedVarNames</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>For each <var>n</var> in <var>varNames</var>, do<ol><li>If <var>n</var> is not an element of <var>instantiatedVarNames</var>, then<ol><li>Append <var>n</var> to <var>instantiatedVarNames</var>.</li><li>Let <var>status</var> be <var>varEnvRec</var>.CreateMutableBinding(<var>n</var>).</li><li>Assert: <var>status</var> is never an <emu-xref href="#sec-completion-record-specification-type"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-completion-record-specification-type">abrupt completion</a></emu-xref>.</li><li>If <var>n</var> is not an element of <var>parameterNames</var> or if <var>n</var> is an element of <var>functionNames</var>, let <var>initialValue</var> be <emu-val>undefined</emu-val>.</li><li>else,<ol><li>Let <var>initialValue</var> be <var>envRec</var>.GetBindingValue(<var>n</var>, <emu-val>false</emu-val>).</li><li><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-returnifabrupt">ReturnIfAbrupt</a>(<var>initialValue</var>).</li></ol></li><li>Call <var>varEnvRec</var>.InitializeBinding(<var>n</var>, <var>initialValue</var>).</li><li>NOTE vars whose names are the same as a formal parameter, initially have the same value as the corresponding initialized parameter.</li></ol></li></ol></li></ol></li><li>NOTE: Annex <emu-xref href="#sec-web-compat-functiondeclarationinstantiation"></emu-xref> adds additional steps at this point.</li><li>If <var>strict</var> is <emu-val>false</emu-val>, then<ol><li>Let <var>lexEnv</var> be <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-newdeclarativeenvironment">NewDeclarativeEnvironment</a>(<var>varEnv</var>).</li><li>NOTE: Non-strict functions use a separate lexical <emu-xref href="#sec-environment-records"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-environment-records">Environment Record</a></emu-xref> for top-level lexical declarations so that a direct <code>eval</code> (see <emu-xref href="#sec-function-calls-runtime-semantics-evaluation"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-function-calls-runtime-semantics-evaluation">12.3.4.1</a></emu-xref>) can determine whether any var scoped declarations introduced by the eval code conflict with pre-existing top-level lexically scoped declarations. This is not needed for strict functions because a strict direct <code>eval</code> always places all declarations into a new <emu-xref href="#sec-environment-records"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-environment-records">Environment Record</a></emu-xref>.</li></ol></li><li>Else, let <var>lexEnv</var> be <var>varEnv</var>.</li><li>Let <var>lexEnvRec</var> be <var>lexEnv</var>'s <emu-xref href="#sec-lexical-environments"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-lexical-environments">EnvironmentRecord</a></emu-xref>.</li><li>Set the LexicalEnvironment of <var>calleeContext</var> to <var>lexEnv</var>.</li><li>Let <var>lexDeclarations</var> be the LexicallyScopedDeclarations of <var>code</var>.</li><li>For each element <var>d</var> in <var>lexDeclarations</var> do<ol><li>NOTE A lexically declared name cannot be the same as a function/generator declaration, formal parameter, or a var name. Lexically declared names are only instantiated here but not initialized.</li><li>For each element <var>dn</var> of the BoundNames of <var>d</var> do<ol><li>If IsConstantDeclaration of <var>d</var> is <emu-val>true</emu-val>, then<ol><li>Let <var>status</var> be <var>lexEnvRec</var>.CreateImmutableBinding(<var>dn</var>, <emu-val>true</emu-val>).</li></ol></li><li>Else,<ol><li>Let <var>status</var> be <var>lexEnvRec</var>.CreateMutableBinding(<var>dn</var>, <emu-val>false</emu-val>).</li></ol></li></ol></li><li>Assert: <var>status</var> is never an <emu-xref href="#sec-completion-record-specification-type"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-completion-record-specification-type">abrupt completion</a></emu-xref>.</li></ol></li><li>For each parsed grammar phrase <var>f</var> in <var>functionsToInitialize</var>, do<ol><li>Let <var>fn</var> be the sole element of the BoundNames of <var>f</var>.</li><li>Let <var>fo</var> be the result of performing InstantiateFunctionObject for <var>f</var> with argument <var>lexEnv</var>.</li><li>Let <var>status</var> be <var>varEnvRec</var>.SetMutableBinding(<var>fn</var>, <var>fo</var>, <emu-val>false</emu-val>).</li><li>Assert: <var>status</var> is never an <emu-xref href="#sec-completion-record-specification-type"><a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-completion-record-specification-type">abrupt completion</a></emu-xref>.</li></ol></li><li>Return <a href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-normalcompletion">NormalCompletion</a>(<emu-const>empty</emu-const>).
  </li></ol></emu-alg>
</emu-note></emu-clause><emu-annex id="sec-copyright-and-software-license">
      <h1><span class="secnum">A</span>Copyright &amp; Software License<span class="utils"><span class="anchor"><a href="#sec-copyright-and-software-license">#</a></span></span></h1>
      
      <h2>Copyright Notice</h2>
      <p>© 2015 Microsoft, Inc.</p>

      <h2>Software License</h2>
      <p>All Software contained in this document ("Software") is protected by copyright and is being made available under the "BSD License", included below. This Software may be subject to third party rights (rights from parties other than Ecma International), including patent rights, and no licenses under such third party rights are granted under this license even if the third party concerned is a member of Ecma International. SEE THE ECMA CODE OF CONDUCT IN PATENT MATTERS AVAILABLE AT http://www.ecma-international.org/memento/codeofconduct.htm FOR INFORMATION REGARDING THE LICENSING OF PATENT CLAIMS THAT ARE REQUIRED TO IMPLEMENT ECMA INTERNATIONAL STANDARDS.</p>

<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>

<ol>
  <li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
  <li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
  <li>Neither the name of the authors nor Ecma International may be used to endorse or promote products derived from this software without specific prior written permission.</li>
</ol>

<p>THIS SOFTWARE IS PROVIDED BY THE ECMA INTERNATIONAL "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL ECMA INTERNATIONAL BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>

    </emu-annex>
</body>